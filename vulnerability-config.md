# üîß Configura√ß√£o de Vulnerabilidades

Este guia explica como configurar e testar as vulnerabilidades intencionais na aplica√ß√£o para validar a esteira de seguran√ßa.

## üéõÔ∏è Controle via Vari√°veis de Ambiente

### Vari√°veis Principais

```bash
# Controle Geral
SAST_VULNS=true/false      # Ativa/desativa todas vulnerabilidades SAST
SCM_VULNS=true/false       # Ativa/desativa todas vulnerabilidades SCM  
DAST_VULNS=true/false      # Ativa/desativa todas vulnerabilidades DAST

# Controle Espec√≠fico
XSS_VULN=true/false        # Cross-Site Scripting
SQL_INJECTION_VULN=true/false  # SQL Injection
COMMAND_INJECTION_VULN=true/false  # Command Injection
PATH_TRAVERSAL_VULN=true/false  # Path Traversal
HARDCODED_SECRETS_VULN=true/false  # Hardcoded Secrets
INSECURE_DEPENDENCIES=true/false  # Insecure Dependencies
```

### Valores Padr√£o

Por padr√£o, **todas as vulnerabilidades est√£o DESATIVADAS** (`false`) para garantir uma aplica√ß√£o segura.

## üß™ Cen√°rios de Teste

### 1. Aplica√ß√£o Segura (Padr√£o)
```bash
# N√£o configure nenhuma vari√°vel - todas ser√£o false por padr√£o
python app.py
```

### 2. Teste Apenas SAST
```bash
export SAST_VULNS=true
export XSS_VULN=true
export SQL_INJECTION_VULN=true
export COMMAND_INJECTION_VULN=true
export SCM_VULNS=false
export DAST_VULNS=false
python app.py
```

### 3. Teste Apenas SCM
```bash
export SAST_VULNS=false
export SCM_VULNS=true
export HARDCODED_SECRETS_VULN=true
export INSECURE_DEPENDENCIES=true
export DAST_VULNS=false
python app.py
```

### 4. Teste Apenas DAST
```bash
export SAST_VULNS=false
export SCM_VULNS=false
export DAST_VULNS=true
export PATH_TRAVERSAL_VULN=true
python app.py
```

### 5. Teste Completo (Todas vulnerabilidades ativas)
```bash
export SAST_VULNS=true
export SCM_VULNS=true
export DAST_VULNS=true
export XSS_VULN=true
export SQL_INJECTION_VULN=true
export COMMAND_INJECTION_VULN=true
export PATH_TRAVERSAL_VULN=true
export HARDCODED_SECRETS_VULN=true
export INSECURE_DEPENDENCIES=true
python app.py
```

## üê≥ Teste com Docker

### Build da Imagem
```bash
docker build -t security-test-app .
```

### Execu√ß√£o com Vulnerabilidades Desativadas
```bash
docker run -p 5000:5000 \
  -e SAST_VULNS=false \
  -e SCM_VULNS=false \
  -e DAST_VULNS=false \
  security-test-app
```

### Execu√ß√£o com Vulnerabilidades Ativas
```bash
docker run -p 5000:5000 \
  -e SAST_VULNS=true \
  -e SCM_VULNS=true \
  -e DAST_VULNS=true \
  -e XSS_VULN=true \
  -e SQL_INJECTION_VULN=true \
  -e COMMAND_INJECTION_VULN=true \
  -e PATH_TRAVERSAL_VULN=true \
  -e HARDCODED_SECRETS_VULN=true \
  -e INSECURE_DEPENDENCIES=true \
  security-test-app
```

## üîç Verifica√ß√£o do Status

### Via Interface Web
Acesse http://localhost:5000 e veja o status visual das vulnerabilidades.

### Via API
```bash
# Status completo das vulnerabilidades
curl http://localhost:5000/api/config

# Health check com status resumido
curl http://localhost:5000/health
```

### Via Logs
Os logs da aplica√ß√£o mostram o status no startup:
```
INFO:__main__:Vulnerability Status:
INFO:__main__:  SAST_VULNS: false
INFO:__main__:  SCM_VULNS: false
INFO:__main__:  DAST_VULNS: false
INFO:__main__:  XSS_VULN: false
INFO:__main__:  SQL_INJECTION_VULN: false
INFO:__main__:  COMMAND_INJECTION_VULN: false
INFO:__main__:  PATH_TRAVERSAL_VULN: false
INFO:__main__:  HARDCODED_SECRETS_VULN: false
INFO:__main__:  INSECURE_DEPENDENCIES: false
```

## üõ°Ô∏è Vulnerabilidades Implementadas

### SAST (Static Application Security Testing)

#### 1. Cross-Site Scripting (XSS)
- **Endpoint**: `/` (interface web)
- **Vulnerabilidade**: Uso de `innerHTML` sem sanitiza√ß√£o
- **Teste**: Digite `<script>alert('XSS')</script>` no campo de nome
- **Detec√ß√£o**: SonarCloud deve detectar uso inseguro de `innerHTML`

#### 2. SQL Injection
- **Endpoint**: `/api/user/<user_id>`
- **Vulnerabilidade**: String concatenation em queries SQL
- **Teste**: Acesse `/api/user/1; DROP TABLE users;`
- **Detec√ß√£o**: SonarCloud deve detectar SQL injection

#### 3. Command Injection
- **Endpoint**: `/api/ping` (POST)
- **Vulnerabilidade**: Execu√ß√£o direta de comandos do sistema
- **Teste**: Envie `{"host": "localhost; rm -rf /"}`
- **Detec√ß√£o**: SonarCloud deve detectar command injection

### SCM (Software Composition Management)

#### 1. Hardcoded Secrets
- **Endpoint**: `/api/secrets`
- **Vulnerabilidade**: Senhas e chaves hardcoded no c√≥digo
- **Conte√∫do**: Database passwords, API keys, JWT secrets
- **Detec√ß√£o**: SonarCloud deve detectar hardcoded secrets

#### 2. Insecure Dependencies
- **Endpoint**: `/api/dependencies`
- **Vulnerabilidade**: Vers√µes vulner√°veis de bibliotecas
- **Depend√™ncias**: requests==2.25.1, urllib3==1.26.5, etc.
- **Detec√ß√£o**: Trivy deve detectar depend√™ncias vulner√°veis

### DAST (Dynamic Application Security Testing)

#### 1. Path Traversal
- **Endpoint**: `/api/file/<file_path>`
- **Vulnerabilidade**: Acesso a arquivos sem valida√ß√£o de path
- **Teste**: Acesse `/api/file/../../../etc/passwd`
- **Detec√ß√£o**: ZAP deve detectar path traversal

#### 2. Insecure Headers
- **Endpoint**: `/api/headers`
- **Vulnerabilidade**: Headers HTTP que exp√µem informa√ß√µes
- **Headers**: X-Powered-By, Server, X-Frame-Options: NONE
- **Detec√ß√£o**: ZAP deve detectar headers inseguros

## üöÄ Testando a Esteira de Seguran√ßa

### 1. Configure os Secrets no GitHub
Siga o guia em [github-secrets-config.md](github-secrets-config.md)

### 2. Teste SAST
```bash
# Configure no GitHub Secrets:
SAST_VULNS=true
XSS_VULN=true
SQL_INJECTION_VULN=true
COMMAND_INJECTION_VULN=true

# Fa√ßa commit e push
git add .
git commit -m "Test SAST vulnerabilities"
git push origin main
```

### 3. Teste SCM
```bash
# Configure no GitHub Secrets:
SCM_VULNS=true
HARDCODED_SECRETS_VULN=true
INSECURE_DEPENDENCIES=true

# Fa√ßa commit e push
git add .
git commit -m "Test SCM vulnerabilities"
git push origin main
```

### 4. Teste DAST
```bash
# Configure no GitHub Secrets:
DAST_VULNS=true
PATH_TRAVERSAL_VULN=true

# Fa√ßa commit e push
git add .
git commit -m "Test DAST vulnerabilities"
git push origin main
```

## üìä Resultados Esperados

### Com Vulnerabilidades Desativadas
- ‚úÖ **SonarCloud**: Passa sem problemas cr√≠ticos
- ‚úÖ **Trivy**: Detecta poucas ou nenhuma vulnerabilidade
- ‚úÖ **ZAP**: Encontra poucos problemas
- ‚úÖ **Quality Gate**: Aprovado

### Com Vulnerabilidades Ativadas
- ‚ö†Ô∏è **SonarCloud**: Detecta vulnerabilidades de c√≥digo
- ‚ö†Ô∏è **Trivy**: Detecta depend√™ncias vulner√°veis
- ‚ö†Ô∏è **ZAP**: Detecta vulnerabilidades web
- ‚ùå **Quality Gate**: Pode falhar

## üîß Troubleshooting

### Problema: Vulnerabilidades n√£o est√£o sendo ativadas
**Solu√ß√£o**: 
1. Verifique se as vari√°veis est√£o configuradas corretamente
2. Use `true` (min√∫sculo) n√£o `True` ou `TRUE`
3. Verifique os logs da aplica√ß√£o no startup

### Problema: Build falha no Docker
**Solu√ß√£o**: 
1. As depend√™ncias foram atualizadas para vers√µes compat√≠veis
2. Verifique se o Dockerfile est√° correto
3. Verifique os logs do build

### Problema: Ferramentas n√£o detectam vulnerabilidades
**Solu√ß√£o**:
1. Verifique se as vulnerabilidades est√£o realmente ativas
2. Teste manualmente os endpoints vulner√°veis
3. Verifique a configura√ß√£o das ferramentas de seguran√ßa

## ‚ö†Ô∏è Aviso de Seguran√ßa

‚ö†Ô∏è **ATEN√á√ÉO**: Esta aplica√ß√£o cont√©m vulnerabilidades intencionais para fins de teste. 

- **NUNCA** use em ambiente de produ√ß√£o
- **NUNCA** use com dados reais
- **NUNCA** exponha em redes p√∫blicas
- Use apenas para **testes de seguran√ßa** em ambiente controlado

## üìö Documenta√ß√£o Adicional

- [Configura√ß√£o de Secrets](github-secrets-config.md)
- [README Principal](README.md)
- [SonarCloud Rules](https://rules.sonarsource.com/)
- [Trivy Vulnerability Database](https://aquasecurity.github.io/trivy/v0.18.3/vulnerability/examples/)
- [ZAP Proxy Documentation](https://www.zaproxy.org/docs/) 